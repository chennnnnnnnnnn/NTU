# 六個資料夾綜合分析報告

**生成日期**: 2024-12-15

---

## 目錄
1. [資料夾概覽](#1-資料夾概覽)
2. [各資料夾個別結果](#2-各資料夾個別結果)
3. [舊版三資料夾結果](#3-舊版三資料夾結果)
4. [新版三資料夾結果](#4-新版三資料夾結果)
5. [舊版 vs 新版比較](#5-舊版-vs-新版比較)
6. [六資料夾總結](#6-六資料夾總結)
7. [結論與建議](#7-結論與建議)

---

## 1. 資料夾概覽

| 資料夾 | 版本 | 特徵類型 | 右設限處理 | 基因集 |
|--------|------|----------|------------|--------|
| **Clinical** | 舊版 | 臨床 (Age+Stage) | 無 | - |
| **Gene** | 舊版 | 基因 (11 genes) | 無 | Intersection |
| **Clinical_Gene** | 舊版 | 臨床+基因+PCA | 無 | Intersection |
| **Clinical2** | 新版 | 臨床 (Age+Stage) | **有** | - |
| **Gene2** | 新版 | 基因 (11 genes) | **有** | Intersection |
| **Clinical_Gene_2** | 新版 | 臨床+基因+PCA | **有** | Intersection |

---

## 2. 各資料夾個別結果

### 2.1 AUC 統計總表

| 資料夾 | 版本 | DFS Mean | DFS Max | DFS Best Year | OS Mean | OS Max | OS Best Year |
|--------|------|----------|---------|---------------|---------|--------|--------------|
| Clinical | 舊版 | 0.534 | 0.636 | Year 6 | 0.555 | 0.733 | Year 9 |
| Gene | 舊版 | 0.568 | 0.668 | Year 9 | 0.582 | 0.703 | Year 10 |
| Clinical_Gene | 舊版 | 0.578 | 0.706 | Year 10 | 0.599 | 0.730 | Year 10 |
| Clinical2 | 新版 | **0.584** | 0.726 | Year 3 | 0.653 | 0.860 | Year 1 |
| Gene2 | 新版 | 0.547 | 0.672 | Year 2 | 0.618 | 0.771 | Year 2 |
| Clinical_Gene_2 | 新版 | 0.572 | **0.743** | Year 10 | **0.671** | **0.891** | Year 1 |

---

## 3. 舊版三資料夾結果 (無右設限處理)

### 3.1 特徵

| 資料夾 | 特徵數 | 特徵內容 |
|--------|--------|----------|
| Clinical | 2 | Diagnosis Age, Stage_Group |
| Gene | 11 + PCA | 11 intersection genes + 200 PCs |
| Clinical_Gene | 2 + 11 + PCA | Age, Stage + 11 genes + 200 PCs |

### 3.2 DFS 結果

| 資料夾 | Mean AUC | Max AUC | Best Year |
|--------|----------|---------|-----------|
| Clinical | 0.534 | 0.636 | 6 |
| Gene | 0.568 | 0.668 | 9 |
| **Clinical_Gene** | **0.578** | **0.706** | 10 |

**舊版 DFS 結論**: Clinical_Gene 表現最佳

### 3.3 OS 結果

| 資料夾 | Mean AUC | Max AUC | Best Year |
|--------|----------|---------|-----------|
| Clinical | 0.555 | 0.733 | 9 |
| Gene | 0.582 | 0.703 | 10 |
| **Clinical_Gene** | **0.599** | **0.730** | 10 |

**舊版 OS 結論**: Clinical_Gene 表現最佳

### 3.4 舊版特點
- 未處理右設限問題，可能導致預測偏差
- 長期預測 (Year 9-10) 表現較好，但可能有資訊洩漏
- 整體 AUC 較低 (DFS: 0.53-0.58, OS: 0.56-0.60)

---

## 4. 新版三資料夾結果 (有右設限處理)

### 4.1 特徵

| 資料夾 | 特徵數 | 特徵內容 |
|--------|--------|----------|
| Clinical2 | 2 | Diagnosis Age, Stage_Group |
| Gene2 | 11 + PCA | 11 intersection genes + 200 PCs |
| Clinical_Gene_2 | 2 + 11 + PCA | Age, Stage + 11 genes + 200 PCs |

### 4.2 DFS 結果

| 資料夾 | Mean AUC | Max AUC | Best Year |
|--------|----------|---------|-----------|
| **Clinical2** | **0.584** | 0.726 | 3 |
| Gene2 | 0.547 | 0.672 | 2 |
| Clinical_Gene_2 | 0.572 | **0.743** | 10 |

**新版 DFS 結論**: Clinical2 (僅臨床特徵) 平均表現最佳

### 4.3 OS 結果

| 資料夾 | Mean AUC | Max AUC | Best Year |
|--------|----------|---------|-----------|
| Clinical2 | 0.653 | 0.860 | 1 |
| Gene2 | 0.618 | 0.771 | 2 |
| **Clinical_Gene_2** | **0.671** | **0.891** | 1 |

**新版 OS 結論**: Clinical_Gene_2 (臨床+基因) 表現最佳

### 4.4 新版特點
- 正確處理右設限，結果更可靠
- 短期預測 (Year 1-3) 表現最好
- 整體 AUC 明顯提升 (尤其 OS)

---

## 5. 舊版 vs 新版比較

### 5.1 AUC 變化

| 比較 | DFS 變化 | OS 變化 |
|------|----------|---------|
| Clinical → Clinical2 | +9.50% | **+17.57%** |
| Gene → Gene2 | -3.71% | +6.10% |
| Clinical_Gene → Clinical_Gene_2 | -1.10% | **+12.06%** |

### 5.2 關鍵發現

1. **OS 預測大幅改善**
   - 所有資料夾的 OS AUC 都提升
   - Clinical 提升最多 (+17.57%)
   - 說明右設限處理對 OS 預測影響很大

2. **DFS 預測變化不一**
   - Clinical 提升 (+9.50%)
   - Gene 和 Clinical_Gene 略降 (-3.71%, -1.10%)
   - 可能因為 DFS 事件記錄本身就有問題

3. **最佳年份改變**
   - 舊版: 長期預測 (Year 9-10) 較好
   - 新版: 短期預測 (Year 1-3) 較好
   - 新版結果更符合預期 (短期預測應更準確)

### 5.3 為什麼新版更可靠?

| 問題 | 舊版 | 新版 |
|------|------|------|
| 右設限樣本 | 保留 (導致 label 不確定) | 刪除 (label 確定) |
| 資訊洩漏 | 可能存在 | 已避免 |
| 預測偏差 | 可能偏高 | 更準確 |

---

## 6. 六資料夾總結

### 6.1 排名 (依 Mean AUC)

**DFS 排名:**
| 排名 | 資料夾 | Mean AUC | 版本 |
|------|--------|----------|------|
| 1 | **Clinical2** | **0.584** | 新版 |
| 2 | Clinical_Gene | 0.578 | 舊版 |
| 3 | Clinical_Gene_2 | 0.572 | 新版 |
| 4 | Gene | 0.568 | 舊版 |
| 5 | Gene2 | 0.547 | 新版 |
| 6 | Clinical | 0.534 | 舊版 |

**OS 排名:**
| 排名 | 資料夾 | Mean AUC | 版本 |
|------|--------|----------|------|
| 1 | **Clinical_Gene_2** | **0.671** | 新版 |
| 2 | Clinical2 | 0.653 | 新版 |
| 3 | Gene2 | 0.618 | 新版 |
| 4 | Clinical_Gene | 0.599 | 舊版 |
| 5 | Gene | 0.582 | 舊版 |
| 6 | Clinical | 0.555 | 舊版 |

### 6.2 最佳配置

| 預測任務 | 最佳資料夾 | Mean AUC | Max AUC |
|----------|------------|----------|---------|
| **DFS** | Clinical2 | 0.584 | 0.726 |
| **OS** | Clinical_Gene_2 | 0.671 | 0.891 |

---

## 7. 結論與建議

### 7.1 主要結論

1. **新版 (有右設限) 結果更可靠**
   - OS 預測明顯改善 (+6% ~ +18%)
   - 最佳年份從長期變短期，更符合預期

2. **臨床特徵是 DFS 預測的核心**
   - Clinical2 (僅 Age+Stage) 效果最好
   - 加入基因特徵反而略降

3. **基因特徵對 OS 預測有幫助**
   - Clinical_Gene_2 優於 Clinical2 (+2.8%)
   - 結合臨床+基因效果最佳

4. **Gene 單獨使用效果有限**
   - 無論新舊版，Gene 表現都較差
   - 需要結合臨床資訊

### 7.2 建議

| 使用場景 | 建議方案 | 說明 |
|----------|----------|------|
| **DFS 預測** | Clinical2 | 簡單有效，僅需 Age + Stage |
| **OS 預測** | Clinical_Gene_2 | 結合臨床+基因效果最佳 |
| **快速評估** | Clinical2 | 資料取得容易，運算快 |
| **精確預測** | Clinical_Gene_2 | 需要基因資料，但效果最佳 |

### 7.3 注意事項

- 務必使用**新版** (有右設限處理) 的結果
- 長期預測 (>5 年) 因樣本減少，結果僅供參考
- 短期預測 (1-3 年) 最可靠

---

## 附錄: 生成的檔案

| 檔案 | 說明 |
|------|------|
| `analyze_all_results.py` | 分析腳本 |
| `all_datasets_statistics.csv` | 統計數據表 |
| `all_6_datasets_comparison.png` | 6 資料夾比較圖 |
| `old_vs_new_comparison.png` | 舊版 vs 新版比較圖 |
| `feature_type_comparison.png` | 特徵類型比較圖 |
| `old_new_direct_comparison.png` | 新舊版直接對比圖 |

---

*報告完成*
